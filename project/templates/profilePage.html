{%extends "layout.html"%}
{%block head%}
	<title>{{user}}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script type="text/javascript" src="{{url_for("static", filename="bower_components/socket.io-client/dist/socket.io.slim.js")}}"></script>
	<script type="text/javascript">
		function joinLobby(lobbycode, username) {
			var socket = io.connect('http://' + document.domain + ':' + location.port);
			socket.on('connect', function() {
				console.log(lobbycode);
				socket.emit('join', {'code':lobbycode, 'username':username});
			});
			var req = new XMLHttpRequest(); 
			req.open("POST", "/profile/"+username);
			req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			req.onreadystatechange = function() {
				if (req.readyState == 4) 
				{
					if (req.status == 302 || req.status == 200) 
					{
						window.location.replace(req.responseText);
					}
				}
			}
			var data = "code="+lobbycode;
			req.send(data);
		}
	</script>
{%endblock%}
{%block body%}
	<div id="container">
		<h1 class="text-center">Welcome, {{user}}</h1>
		<form action="javascript:joinLobby(join.value, '{{user}}')" class="text-center">
			<div>
				Join Lobby:  <input type="text" name="join" id="join" required>
				
				<input type="submit" value="Join Lobby">
			</div>
		</form>
		<div class="text-center">
				<a href="{{ url_for("unlogger") }}">click here to logout</a>
		</div>
	</div>
{%endblock%}
